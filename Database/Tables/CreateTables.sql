SET NOCOUNT ON

DROP TABLE IF EXISTS TAG;
DROP TABLE IF EXISTS OBJECT;
DROP TABLE IF EXISTS OBJECT_TYPE;
DROP TABLE IF EXISTS HIERARCHY_2;
DROP TABLE IF EXISTS HIERARCHY_1;
DROP TABLE IF EXISTS EAS_GROUP;--EAS group
DROP TABLE IF EXISTS ALARM_GROUP;-- alarm group
DROP TABLE IF EXISTS VDU_GROUP;-- customer defined groups
DROP TABLE IF EXISTS OTD_INTERFACE;
DROP TABLE IF EXISTS OTD;
DROP TABLE IF EXISTS ACKNOWLEDGE_ALLOWED;
DROP TABLE IF EXISTS ALWAYS_VISIBLE;
DROP TABLE IF EXISTS NODE;
DROP TABLE IF EXISTS LOCATION_GROUP;
DROP TABLE IF EXISTS CABINET;
DROP TABLE IF EXISTS DATA_BLOCK;
DROP TABLE IF EXISTS IO_SIGNAL_TYPE;
DROP TABLE IF EXISTS MODULE_CONFIG;
DROP TABLE IF EXISTS TERMINATION_CONFIG;
DROP TABLE IF EXISTS MODULE_TYPE;
DROP TABLE IF EXISTS ENG_UNIT;
DROP TABLE IF EXISTS BEIJER_BOX;
DROP TABLE IF EXISTS SYMBOL;
DROP TABLE IF EXISTS SIGNAL_TYPE;
DROP TABLE IF EXISTS IO_TYPE;


CREATE TABLE HIERARCHY_1
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name varchar(50) NOT NULL UNIQUE
)
GO

CREATE TABLE HIERARCHY_2
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name varchar(50) NOT NULL UNIQUE,
	Hierarchy1Id int NOT NULL FOREIGN KEY REFERENCES HIERARCHY_1(Id)
)
GO

CREATE TABLE VDU_GROUP
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name varchar(50) NOT NULL UNIQUE
)
GO

CREATE TABLE EAS_GROUP
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name varchar(50) NOT NULL UNIQUE
)
GO

CREATE TABLE ALARM_GROUP
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name varchar(50) NOT NULL UNIQUE
)
GO

CREATE TABLE OTD
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name varchar(50) NOT NULL UNIQUE
)
GO

CREATE TABLE OTD_INTERFACE
(
	Id int PRIMARY KEY IDENTITY (1,1),
	OtdId int NOT NULL FOREIGN KEY REFERENCES OTD(Id),
	Name varchar(150) NOT NULL,
	Suffix varchar(50) NOT NULL,
	DataType varchar(100) NOT NULL,
	InterfaceType varchar(150) NOT NULL,
	IsOptional bit
)

CREATE TABLE LOCATION_GROUP
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name varchar(200) NOT NULL UNIQUE
)
GO

CREATE TABLE NODE
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name varchar(50) NOT NULL UNIQUE
)
GO

CREATE TABLE CABINET
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name varchar(50) NOT NULL UNIQUE,
	Description varchar(150),
	NoIMs int,
	NoSlotsPerIM int
)
GO

CREATE TABLE IO_TYPE
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name varchar(50) NOT NULL UNIQUE
)
GO

CREATE TABLE SIGNAL_TYPE
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name varchar(50),
)
GO

CREATE TABLE IO_SIGNAL_TYPE
(
	Id int PRIMARY KEY IDENTITY (1,1),
	IoTypeId int NOT NULL FOREIGN KEY REFERENCES IO_TYPE(Id),
	SignalTypeId int NOT NULL FOREIGN KEY REFERENCES SIGNAL_TYPE(Id)
)
GO

CREATE TABLE MODULE_TYPE
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name varchar(150) NOT NULL UNIQUE,
	OrderNumber VARCHAR(255) NOT NULL UNIQUE,
	Channels int NOT NULL,
	InBytes int NOT NULL,
	InBits int NOT NULL,
	OutBytes int NOT NULL,
	OutBits int NOT NULL,
	QIBytes int
)

CREATE TABLE TERMINATION_CONFIG
(
	Id int PRIMARY KEY IDENTITY (1,1),
	IoTypeId int NOT NULL FOREIGN KEY REFERENCES IO_TYPE(Id),
	SignalTypeId int NOT NULL FOREIGN KEY REFERENCES SIGNAL_TYPE(Id),
	ModuleTypeId int NOT NULL FOREIGN KEY REFERENCES MODULE_TYPE(Id)
)

CREATE TABLE MODULE_CONFIG
(
	Id int PRIMARY KEY IDENTITY (1,1),
	IoTypeId int NOT NULL FOREIGN KEY REFERENCES IO_TYPE(Id),
	SignalTypeId int FOREIGN KEY REFERENCES SIGNAL_TYPE(Id),
	ModuleTypeId int NOT NULL FOREIGN KEY REFERENCES MODULE_TYPE(Id)
)

CREATE TABLE ENG_UNIT
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name varchar(50) UNIQUE,
	UnitId int UNIQUE
)
GO

CREATE TABLE SYMBOL
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name varchar(50) UNIQUE,
)
GO

CREATE TABLE OBJECT_TYPE
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name VARCHAR(150),
	OtdId int FOREIGN KEY REFERENCES OTD(Id),
)

CREATE TABLE BEIJER_BOX
(
	Id int PRIMARY KEY IDENTITY (1,1),
	Name VARCHAR(200),
	IpAddress varchar(100)
)

CREATE TABLE OBJECT
(
	Id int PRIMARY KEY IDENTITY (1,1),
	SfiNumber varchar(50) NOT NULL,
	MainEqNumber varchar(50) NOT NULL,
	EqNumber varchar(50),
	Description varchar(150) NOT NULL,
	VduGroupId int NOT NULL FOREIGN KEY REFERENCES VDU_GROUP(Id),
	Hierarchy1Id int FOREIGN KEY REFERENCES HIERARCHY_1(Id),
	Hierarchy2Id int FOREIGN KEY REFERENCES HIERARCHY_2(Id),
	EasGroupId int FOREIGN KEY REFERENCES EAS_GROUP(Id),
	AlarmGroupId int FOREIGN KEY REFERENCES ALARM_GROUP(Id),
	OtdId int FOREIGN KEY REFERENCES OTD(Id),
	ObjectTypeId int FOREIGN KEY REFERENCES OBJECT_TYPE(Id),
	AcknowledgeAllowedId int FOREIGN KEY REFERENCES LOCATION_GROUP(Id),
	AlwaysVisibleId int FOREIGN KEY REFERENCES LOCATION_GROUP(Id),
	NodeId int FOREIGN KEY REFERENCES NODE(Id),
	CabinetId int NOT NULL FOREIGN KEY REFERENCES CABINET(Id),
	Revision varchar(50),
	LastModified DATETIME,
)
GO

CREATE TABLE TAG
(
	Id int PRIMARY KEY IDENTITY (1,1),
	ObjectId int FOREIGN KEY REFERENCES OBJECT(Id),
	ObjectTypeId int FOREIGN KEY REFERENCES OBJECT_TYPE(Id),
	EqSuffix varchar(50) NOT NULL,
	Description varchar(150) NOT NULL,
	IoTypeId int NOT NULL FOREIGN KEY REFERENCES IO_TYPE(Id),
	SignalTypeId int FOREIGN KEY REFERENCES SIGNAL_TYPE(Id),
	SymbolId int FOREIGN KEY REFERENCES SYMBOL(Id),
	EngUnitId int FOREIGN KEY REFERENCES ENG_UNIT(Id),
	AlarmDelay varchar(50),
	RangeLow int,
	RangeHigh int,
	LowLowLimit int,
	LowLimit int,
	HighLimit int,
	HighHighLimit int,
	Slot int,
	Channel int,
	TP1 int,
	TP2 int,
	TP3 int,
	TP4 int,
	AbsoluteAddress varchar(50),
	SWPath varchar(150),
	DBName varchar(150),
	ModbusAddress int,
	ModbusBit int,
	IsE0 bit,
	IsVDR bit,
	IOStatus varchar(100),
	LastModified DATETIME,
	InterfaceModule varchar(50),
	UserLock bit,
	IOLock bit,
	BeijerBoxId int FOREIGN KEY REFERENCES BEIJER_BOX(Id)
)
GO
